:root{
  --bg:#0b1220;--card:#0f1930;--ink:#eaf0ff;--muted:#b9c7eb;--grid:#1f2d4f;
  --accent:#87a7ff;--good:#6be675;--bad:#ff7a88;--warn:#ffd166;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font:15.5px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,rgba(11,18,32,.96),rgba(11,18,32,.84));backdrop-filter:blur(6px)}
.wrap{max-width:1200px;margin:0 auto;padding:14px}
h1{margin:0;font-size:1.2rem}
.pill{display:inline-block;padding:2px 8px;border:1px solid var(--grid);border-radius:999px;background:#132046}
.top{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:6px}
.badge{display:inline-block;padding:6px 10px;border:1px solid var(--grid);border-radius:10px;background:#0c1630}
button{background:#1a2647;color:var(--ink);border:1px solid var(--grid);padding:9px 12px;border-radius:10px;cursor:pointer}
button.primary{background:var(--accent);color:#0b1220;border:none;font-weight:700}
button.danger{background:#ff5b6b;color:#0b1220;border:none;font-weight:700}
.grid{display:grid;gap:12px;grid-template-columns:1.1fr 1fr}
.card{background:var(--card);border:1px solid var(--grid);border-radius:14px;overflow:hidden}
.card h3{margin:0;padding:10px;border-bottom:1px solid var(--grid)}
.section{padding:10px}
.kpi{display:grid;gap:8px;grid-template-columns:repeat(4,minmax(150px,1fr))}
.kpi .box{padding:10px;border:1px solid var(--grid);border-radius:12px;background:#0c1530}
table{width:100%;border-collapse:collapse}
th,td{padding:7px;border-bottom:1px solid var(--grid);text-align:right;font-variant-numeric:tabular-nums}
th:first-child,td:first-child{text-align:left}
.note{color:#a9b6db}.gain{color:var(--good)}.warn{color:var(--warn)}
.log{max-height:220px;overflow:auto;border-top:1px solid var(--grid);background:#0c1630}
.log-item{padding:7px 10px;border-bottom:1px dashed #1e2a4e}
.chart{width:100%;height:220px;background:#0b1432;border:1px solid var(--grid);border-radius:10px;margin-top:8px}

/* === Controls grid: etichetta | controllo | valore (anticut) === */
.controls-grid{
  display:grid;
  grid-template-columns: minmax(160px,1fr) minmax(260px,2fr) minmax(120px,auto);
  gap: 10px 14px;
  align-items: center;
  margin-bottom: 8px;
}
.controls-grid .label{color: var(--muted);white-space: nowrap;}
.controls-grid .ctrl{width: 100%;}
.controls-grid .value{text-align: right;white-space: nowrap;min-width: 120px;font-variant-numeric: tabular-nums;}
.controls-grid input[type="range"]{width: 100%;}
.controls-grid input[type="number"], .controls-grid select{width: 100%;max-width: 100%;}

/* desktop: un filo più largho e overflow di salvataggio */
@media (min-width: 1024px){
  .wrap{ max-width: 1320px; }
  .card .section{ overflow-x: auto; }
}

/* mobile: valore sotto al controllo */
@media (max-width: 700px){
  .controls-grid{ grid-template-columns: 1fr 1fr; }
  .controls-grid .value{ grid-column: 2 / 3; justify-self: end; }
  .kpi{ grid-template-columns: 1fr 1fr; }
}
/* === MOBILE FIXES — iPhone safe layout === */

/* 1) a larghezze medio/piccole passa a UNA colonna */
@media (max-width: 1100px){
  .grid{ grid-template-columns: 1fr; }
}

/* 2) su tablet/phone le KPI diventano 2 colonne, poi 1 colonna su telefoni stretti */
@media (max-width: 900px){
  .kpi{ grid-template-columns: 1fr 1fr; }
}
@media (max-width: 420px){
  .kpi{ grid-template-columns: 1fr; }
}

/* 3) controlli a griglia: su mobile metti valore sotto al controllo e niente tagli */
@media (max-width: 700px){
  .controls-grid{ grid-template-columns: 1fr; }
  .controls-grid .value{
    grid-column: 1 / -1;
    justify-self: end;
    margin-top: -4px;
  }
}

/* 4) evita overflow orizzontale ovunque e permetti scroll di salvataggio se serve */
html, body { overflow-x: hidden; }
.card .section{ overflow-x: auto; }

/* 5) tabelle sempre scrollabili su x quando lo spazio non basta */
table{ display: block; overflow-x: auto; }

/* 6) gli input non devono mai uscire dal contenitore */
input, select { max-width: 100%; }

/* 7) canvas responsive: il contenitore fa la misura, il JS fa resize */
.chart{ width: 100% !important; height: 220px; }
