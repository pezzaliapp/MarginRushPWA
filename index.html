<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1"/>
  <title>Margin Rush â€” v4.9 Pro (MC â€¢ Copertura â€¢ MoS â€¢ BE)</title>

  <!-- PWA -->
  <meta name="theme-color" content="#0b1220"/>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- === CSS DARK (default) === -->
  <style id="theme-dark">
  :root {
    --bg: #0b1220;
    --bg-card: #0f1930;
    --bg-box: #0c1530;
    --bg-pill: #132046;
    --border: #1f2d4f;
    --text: #eaf0ff;
    --text-muted: #a9b6db;
    --accent-blue: #87a7ff;
    --accent-red: #ff5b6b;
    --accent-yellow: #ffd166;
    --accent-green: #6be675;
  }
  *{box-sizing:border-box}
  body{margin:0;font:15.5px/1.5 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text)}
  header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(11,18,32,.96),rgba(11,18,32,.85));border-bottom:1px solid var(--border)}
  .wrap{max-width:1200px;margin:0 auto;padding:14px}
  h1{margin:0;font-size:1.1rem}
  .pill{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;background:var(--bg-pill);margin-left:6px}
  .top{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--border);border-radius:10px;background:var(--bg-box)}
  .btn{background:#1a2647;color:var(--text);border:1px solid var(--border);padding:9px 12px;border-radius:10px;cursor:pointer;font-size:.9rem}
  .btn.primary{background:var(--accent-blue);color:var(--bg);border:none;font-weight:700}
  .btn.danger{background:var(--accent-red);color:var(--bg);border:none;font-weight:700}
  .grid{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  .card{background:var(--bg-card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
  .card h3{margin:0;padding:10px;border-bottom:1px solid var(--border);font-size:1rem}
  .section{padding:10px}
  .kpi{display:grid;gap:8px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
  .box{padding:10px;border:1px solid var(--border);border-radius:10px;background:var(--bg-box)}
  .note{color:var(--text-muted);font-size:.9rem}
  table{width:100%;border-collapse:collapse;margin-top:6px}
  th,td{padding:6px;border-bottom:1px solid var(--border);text-align:right;font-size:.9rem}
  th:first-child,td:first-child{text-align:left}
  .controls-grid{display:grid;gap:10px 14px;grid-template-columns:minmax(160px,1fr) minmax(260px,2fr) minmax(120px,auto);align-items:center}
  .controls-grid .value{text-align:right;white-space:nowrap}
  .chart{width:100%;height:220px;background:#0b1432;border:1px solid var(--border);border-radius:10px;margin-top:8px}
  .log{max-height:220px;overflow:auto;border-top:1px solid var(--border);background:var(--bg-box)}
  .log-item{padding:7px 10px;border-bottom:1px dashed var(--border);font-size:.85rem;color:var(--text-muted)}
  .warn{color:#ffd166}
  .gain{color:#6be675}
  @media (max-width:1100px){.grid{grid-template-columns:1fr}}
  @media (max-width:900px){.kpi{grid-template-columns:1fr 1fr}}
  @media (max-width:420px){.kpi{grid-template-columns:1fr}.controls-grid{grid-template-columns:1fr}}
  </style>

  <!-- === CSS LIGHT (disattivato; verrÃ  abilitato via JS) === -->
  <style id="theme-light" disabled>
  :root {
    --bg: #f9fafc;
    --bg-card: #ffffff;
    --bg-box: #f2f4f9;
    --bg-pill: #dde3f7;
    --border: #cfd6e6;
    --text: #1c2230;
    --text-muted: #5a678a;
    --accent-blue: #0b5fff;
    --accent-red: #ff3b30;
    --accent-yellow: #f6c744;
    --accent-green: #28a745;
  }
  *{box-sizing:border-box}
  body{margin:0;font:15.5px/1.5 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text)}
  header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(255,255,255,.96),rgba(255,255,255,.9));border-bottom:1px solid var(--border)}
  .wrap{max-width:1200px;margin:0 auto;padding:14px}
  h1{margin:0;font-size:1.1rem}
  .pill{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;background:var(--bg-pill);margin-left:6px}
  .top{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--border);border-radius:10px;background:var(--bg-box)}
  .btn{background:#fff;color:var(--text);border:1px solid var(--border);padding:9px 12px;border-radius:10px;cursor:pointer;font-size:.9rem}
  .btn.primary{background:var(--accent-blue);color:#fff;border:none;font-weight:700}
  .btn.danger{background:var(--accent-red);color:#fff;border:none;font-weight:700}
  .grid{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  .card{background:var(--bg-card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
  .card h3{margin:0;padding:10px;border-bottom:1px solid var(--border);font-size:1rem}
  .section{padding:10px}
  .kpi{display:grid;gap:8px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
  .box{padding:10px;border:1px solid var(--border);border-radius:10px;background:var(--bg-box)}
  .note{color:var(--text-muted);font-size:.9rem}
  table{width:100%;border-collapse:collapse;margin-top:6px}
  th,td{padding:6px;border-bottom:1px solid var(--border);text-align:right;font-size:.9rem}
  th:first-child,td:first-child{text-align:left}
  .controls-grid{display:grid;gap:10px 14px;grid-template-columns:minmax(160px,1fr) minmax(260px,2fr) minmax(120px,auto);align-items:center}
  .controls-grid .value{text-align:right;white-space:nowrap}
  .chart{width:100%;height:220px;background:#fff;border:1px solid var(--border);border-radius:10px;margin-top:8px}
  .log{max-height:220px;overflow:auto;border-top:1px solid var(--border);background:var(--bg-box)}
  .log-item{padding:7px 10px;border-bottom:1px dashed var(--border);font-size:.85rem;color:var(--text-muted)}
  @media (max-width:1100px){.grid{grid-template-columns:1fr}}
  @media (max-width:900px){.kpi{grid-template-columns:1fr 1fr}}
  @media (max-width:420px){.kpi{grid-template-columns:1fr}.controls-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>

<!-- ======================= HEADER ======================= -->
<header>
  <div class="wrap">
    <h1>Margin Rush <span class="pill">v4.9 Pro â€” MC â€¢ Copertura â€¢ MoS â€¢ BE</span></h1>
    <div class="top">
      <div class="badge">Giorno: <b id="day">1</b>/10</div>
      <div class="badge">Cassa: <b id="cash">â‚¬5.000,00</b></div>
      <div class="badge">Quota oggi: <b id="share">0%</b></div>
      <div class="badge">Utile cumulato: <b id="cumprofit">â‚¬0,00</b></div>
      <button id="advance" class="btn primary">Avanza giorno</button>
      <button id="reset" class="btn danger">Nuova partita</button>
      <button id="show-solution" class="btn">ðŸ’¡ Indica la soluzione</button>
      <button id="toggle-theme" class="btn">ðŸŒ— Tema</button>
    </div>
  </div>
</header>

<!-- ======================= MAIN ======================= -->
<main class="wrap">
  <div class="grid">
    <!-- ========== COLONNA SINISTRA: MERCATO ========== -->
    <div class="card">
      <h3>Il mercato (noi vs 3 competitor)</h3>
      <div class="section">
        <div class="kpi">
          <div class="box">Mercato M: <b id="M">1200</b></div>
          <div class="box">StagionalitÃ : <b id="seasonEcho">+0%</b></div>
          <div class="box">Î² sensibilitÃ  prezzo: <b id="betaEcho">0.080</b></div>
          <div class="box">Capienza: <b id="capEcho">1000</b></div>
        </div>

        <table id="tbl">
          <thead>
            <tr><th>Offerta</th><th>Prezzo</th><th>Q</th><th>B</th><th>S</th><th>Quota</th><th>UnitÃ </th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="log" id="log"></div>
    </div>

    <!-- ========== COLONNA DESTRA: LEVE & COSTI ========== -->
    <div class="card">
      <h3>Leve, costi, canali</h3>
      <div class="section">
        <!-- CONTROLLI PRINCIPALI -->
        <div class="controls-grid">
          <div>Prezzo nostro</div>
          <div><input id="price" type="range" min="5" max="120" step="0.5" value="49"></div>
          <div class="value"><b id="priceEcho">â‚¬49,00</b></div>

          <div>QualitÃ  (Q)</div>
          <div><input id="invQ" type="range" min="0" max="3" step="1" value="1"></div>
          <div class="value"><b id="invQEcho">1</b></div>

          <div>Brand (B)</div>
          <div><input id="invB" type="range" min="0" max="3" step="1" value="1"></div>
          <div class="value"><b id="invBEcho">1</b></div>

          <div>Servizio (S)</div>
          <div><input id="invS" type="range" min="0" max="2" step="1" value="1"></div>
          <div class="value"><b id="invSEcho">1</b></div>

          <div>Capienza ordini/g</div>
          <div><input id="cap" type="range" min="300" max="3000" step="50" value="1000"></div>
          <div class="value"><b id="capVal">1000</b></div>
        </div>

        <div class="kpi" style="margin-top:6px">
          <div class="box">IVA inclusa? <input type="checkbox" id="iva" checked></div>
          <div class="box">IVA % <input type="number" id="ivaPct" value="22" step="0.1"></div>
          <div class="box">Î² <input type="number" id="beta" value="0.08" step="0.005"></div>
          <div class="box">Stag. % <input type="number" id="season" value="0" step="1"></div>
        </div>

        <h4 style="margin:10px 0 6px">Costi variabili & vincoli prezzo</h4>
        <div class="kpi">
          <div class="box">Prezzo dâ€™acquisto â‚¬/u<br><input type="number" id="buyCost" value="20" step="0.1"></div>
          <div class="box">Overhead variabile â‚¬/u<br><input type="number" id="varOver" value="1.20" step="0.1"></div>
          <div class="box">Margine minimo %<br><input type="number" id="minMarginPct" value="15" step="0.5"></div>
          <div class="box">Stato margine<br><b id="minMarginWarn">â€”</b></div>
        </div>

        <fieldset>
          <legend>Garanzia</legend>
          <div class="kpi">
            <div class="box">Livello (mesi)<br>
              <select id="wTier">
                <option value="12">12</option>
                <option value="24" selected>24</option>
                <option value="36">36</option>
                <option value="60">60</option>
              </select>
            </div>
            <div class="box">In garanzia %<br><input type="number" id="wRateIn" value="3" step="0.1"></div>
            <div class="box">Costo in garanzia â‚¬<br><input type="number" id="wCostIn" value="40" step="1"></div>
            <div class="box">Goodwill % / â‚¬<br>
              <input type="number" id="wRateOut" value="1" step="0.1" style="width:60px"> /
              <input type="number" id="wCostOut" value="30" step="1" style="width:60px">
            </div>
          </div>
          <div class="kpi">
            <div class="box">Costo garanzia/u<br><b id="wCostPerUnit">â‚¬0,00</b></div>
            <div class="box">MC/u (tutto incluso)<br><b id="mcUnit">â‚¬0,00</b></div>
            <div class="box">Imposta utile %<br><input type="number" id="taxPct" value="24" step="0.1"></div>
            <div class="box">BE u/g (post-tax)<br><b id="beUnits">â€”</b></div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Costi fissi base (giornalieri)</legend>
          <div class="kpi">
            <div class="box">Personale â‚¬/g<br><input type="number" id="fxStaff" value="300" step="10"></div>
            <div class="box">Affitto â‚¬/g<br><input type="number" id="fxRent" value="120" step="10"></div>
            <div class="box">SaaS â‚¬/g<br><input type="number" id="fxSaaS" value="60" step="5"></div>
            <div class="box">Altro â‚¬/g<br><input type="number" id="fxOther" value="20" step="5"></div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Canale di vendita</legend>
          <div class="kpi">
            <div class="box">Canale<br>
              <select id="channel">
                <option value="online" selected>Vendita on-line</option>
                <option value="piva">Venditore a P.IVA</option>
                <option value="employee">Dipendente</option>
              </select>
            </div>
            <div class="box">Fissi canale/g<br><b id="chFixedEcho">â‚¬0,00</b></div>
            <div class="box">Variabile canale/u<br><b id="chVarEcho">â‚¬0,00</b></div>
            <div class="box">Commissione % su netto<br><b id="chPctEcho">0%</b></div>
          </div>

          <!-- ONLINE -->
          <div id="ch-online">
            <div class="kpi">
              <div class="box">Fee piattaforma %<br><input type="number" id="onFeePct" value="6" step="0.1"></div>
              <div class="box">Fee pagamento %<br><input type="number" id="onPayPct" value="2.5" step="0.1"></div>
              <div class="box">Fee fissa ordine â‚¬<br><input type="number" id="onFixedPer" value="0.35" step="0.05"></div>
              <div class="box">Logistica â‚¬/u<br><input type="number" id="onLogPer" value="3" step="0.1"></div>
            </div>
            <div class="kpi">
              <div class="box">SaaS â‚¬/mese<br><input type="number" id="onSaaS" value="100" step="5"></div>
              <div class="box">Gestione store â‚¬/mese<br><input type="number" id="onMgmt" value="150" step="5"></div>
            </div>
          </div>

          <!-- P.IVA -->
          <div id="ch-piva" style="display:none">
            <div class="kpi">
              <div class="box">Auto a noleggio â‚¬/mese<br><input type="number" id="pvAuto" value="400" step="10"></div>
              <div class="box">Compenso fisso â‚¬/mese<br><input type="number" id="pvFixed" value="2000" step="50"></div>
              <div class="box">Provvigione %<br><input type="number" id="pvPct" value="10" step="0.5"></div>
              <div class="box">Telepass â‚¬/km<br><input type="number" id="pvTeleKm" value="0.07" step="0.01"></div>
            </div>
            <div class="kpi">
              <div class="box">Km/mese<br><input type="number" id="pvKm" value="4000" step="100"></div>
              <div class="box">Consumo km/l<br><input type="number" id="pvKml" value="18" step="0.1"></div>
              <div class="box">Carburante â‚¬/l<br><input type="number" id="pvFuel" value="1.70" step="0.01"></div>
              <div class="box">Altre spese â‚¬/mese<br><input type="number" id="pvOtherM" value="0" step="5"></div>
            </div>
          </div>

          <!-- DIPENDENTE -->
          <div id="ch-employee" style="display:none">
            <div class="kpi">
              <div class="box">RAL annua â‚¬<br><input type="number" id="emRal" value="50000" step="500"></div>
              <div class="box">Auto aziendale â‚¬/mese<br><input type="number" id="emAuto" value="450" step="10"></div>
              <div class="box">Telepass â‚¬/mese<br><input type="number" id="emTele" value="30" step="1"></div>
              <div class="box">Trasferte â‚¬/mese<br><input type="number" id="emTrips" value="250" step="10"></div>
            </div>
            <div class="kpi">
              <div class="box">Provvigione % (opz.)<br><input type="number" id="emPct" value="0" step="0.5"></div>
              <div class="box">Km/mese (opz.)<br><input type="number" id="emKm" value="0" step="100"></div>
              <div class="box">Consumo km/l<br><input type="number" id="emKml" value="18" step="0.1"></div>
              <div class="box">Carburante â‚¬/l<br><input type="number" id="emFuel" value="1.70" step="0.01"></div>
            </div>
          </div>
        </fieldset>

        <div class="note" id="advisor" style="margin-top:8px">Advisorâ€¦</div>
        <div id="solution-box" class="box" style="display:none; margin-top:8px"></div>

        <!-- Grafici -->
        <canvas id="beChart" class="chart"></canvas>
        <canvas id="mcChart" class="chart"></canvas>
      </div>
    </div>
  </div>

  <!-- REPORT -->
  <div class="card" style="margin-top:12px">
    <h3>Report del giorno</h3>
    <div class="section">
      <div class="kpi">
        <div class="box">UnitÃ  nostre: <b id="qMe">0</b></div>
        <div class="box">Quota nostra: <b id="sMe">0%</b></div>
        <div class="box">Utile netto: <b id="pMe">â‚¬0,00</b></div>
        <div class="box">Clienti spostati: <b id="moved">0</b></div>
      </div>
      <div class="kpi" style="margin-top:8px">
        <div class="box">MC/u<br><b id="kpiMcUnit">â‚¬0,00</b></div>
        <div class="box">MC totale oggi<br><b id="kpiMcTotal">â‚¬0,00</b></div>
        <div class="box">Indice di copertura<br><b id="kpiCover">0%</b></div>
        <div class="box">Margine di sicurezza<br><b id="kpiMoS">â€”</b></div>
      </div>
      <div class="note" style="margin-top:6px">
        Î” clienti â€” Prezzo: <b id="bp">0</b> Â· Q: <b id="bq">0</b> Â· B: <b id="bb">0</b> Â· S: <b id="bs">0</b>
      </div>
    </div>
  </div>
</main>

<!-- ======================= SCRIPT ======================= -->
<script src="app.js"></script>
</body>
</html>
